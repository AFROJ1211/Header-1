<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scientific Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f4f4f4;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #222;
      color: white;
    }
    .calculator {
      width: 480px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
      transition: background 0.3s, color 0.3s;
    }
    body.dark .calculator {
      background: #333;
      color: white;
    }
    .display {
      width: 100%;
      height: 60px;
      font-size: 24px;
      text-align: right;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
    }
    body.dark .display {
      background: #444;
      color: white;
      border: 1px solid #666;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .tabs button {
      flex: 1;
      padding: 10px;
      margin: 2px;
      border: none;
      background: #eee;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.3s;
    }
    .tabs button.active {
      background: #007bff;
      color: #fff;
    }
    body.dark .tabs button {
      background: #555;
      color: white;
    }
    .buttons {
      display: none;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
    }
    .buttons.active {
      display: grid;
    }
    button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #f1f1f1;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #ddd;
    }
    body.dark button {
      background: #555;
      color: white;
    }
    .equal, .enter {
      background: #28a745;
      color: white;
      font-weight: bold;
    }
    .clear, .clearall {
      background: #dc3545;
      color: white;
      font-weight: bold;
    }
    .special {
      background: #ffc107;
      font-weight: bold;
    }
    #historyPanel {
      display:none;
      max-height:120px;
      overflow-y:auto;
      background:#f9f9f9;
      margin-top:10px;
      padding:5px;
      border:1px solid #ccc;
      border-radius:6px;
    }
    body.dark #historyPanel {
      background:#444;
      border:1px solid #666;
    }
    #historyPanel div {
      padding:3px;
      cursor:pointer;
    }
    #historyPanel div:hover {
      background:#ddd;
    }
    body.dark #historyPanel div:hover {
      background:#555;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <input type="text" id="display" class="display" disabled>

    <div class="tabs">
      <button class="tab active" onclick="showTab('main')">main</button>
      <button class="tab" onclick="showTab('abc')">abc</button>
      <button class="tab" onclick="showTab('func')">func</button>
      <button onclick="setMode('RAD')" id="radBtn">RAD</button>
      <button onclick="setMode('DEG')" id="degBtn">DEG</button>
      <button onclick="undo()">‚éå</button>
      <button onclick="redo()">‚éé</button>
      <button class="clearall" onclick="clearAll()">Clear All</button>
      <button onclick="toggleTheme()">üåô/‚òÄ</button>
    </div>

    <!-- Main Tab -->
    <div id="main" class="buttons active">
      <button onclick="append('7')">7</button>
      <button onclick="append('8')">8</button>
      <button onclick="append('9')">9</button>
      <button onclick="append('/')">√∑</button>
      <button onclick="append('(')">(</button>
      <button onclick="append(')')">)</button>

      <button onclick="append('4')">4</button>
      <button onclick="append('5')">5</button>
      <button onclick="append('6')">6</button>
      <button onclick="append('*')">√ó</button>
      <button onclick="append('[')">[</button>
      <button onclick="append(']')">]</button>

      <button onclick="append('1')">1</button>
      <button onclick="append('2')">2</button>
      <button onclick="append('3')">3</button>
      <button onclick="append('-')">‚àí</button>
      <button onclick="append('pi')">œÄ</button>
      <button onclick="append('e')">e</button>

      <button onclick="append('0')">0</button>
      <button onclick="append('.')">.</button>
      <button onclick="append('+')">+</button>
      <button class="clear" onclick="backspace()">‚úñ</button>
      <button class="equal" onclick="calculate()">=</button>
      <button class="enter" onclick="calculate()">Enter</button>
    </div>

    <!-- ABC Tab (Full A‚ÄìZ) -->
    <div id="abc" class="buttons">
      <button onclick="append('a')">a</button>
      <button onclick="append('b')">b</button>
      <button onclick="append('c')">c</button>
      <button onclick="append('d')">d</button>
      <button onclick="append('e')">e</button>
      <button onclick="append('f')">f</button>
      <button onclick="append('g')">g</button>
      <button onclick="append('h')">h</button>
      <button onclick="append('i')">i</button>
      <button onclick="append('j')">j</button>
      <button onclick="append('k')">k</button>
      <button onclick="append('l')">l</button>
      <button onclick="append('m')">m</button>
      <button onclick="append('n')">n</button>
      <button onclick="append('o')">o</button>
      <button onclick="append('p')">p</button>
      <button onclick="append('q')">q</button>
      <button onclick="append('r')">r</button>
      <button onclick="append('s')">s</button>
      <button onclick="append('t')">t</button>
      <button onclick="append('u')">u</button>
      <button onclick="append('v')">v</button>
      <button onclick="append('w')">w</button>
      <button onclick="append('x')">x</button>
      <button onclick="append('y')">y</button>
      <button onclick="append('z')">z</button>

      <button class="clear" onclick="backspace()">‚úñ</button>
      <button class="equal" onclick="calculate()">=</button>
      <button class="enter" onclick="calculate()">Enter</button>
    </div>

    <!-- Function Tab -->
    <div id="func" class="buttons">
      <button onclick="append('sin(')">sin</button>
      <button onclick="append('cos(')">cos</button>
      <button onclick="append('tan(')">tan</button>
      <button onclick="append('asin(')">sin‚Åª¬π</button>
      <button onclick="append('acos(')">cos‚Åª¬π</button>
      <button onclick="append('atan(')">tan‚Åª¬π</button>

      <button onclick="append('log(')">log</button>
      <button onclick="append('ln(')">ln</button>
      <button onclick="append('sqrt(')">‚àö</button>
      <button onclick="append('^')">x ∏</button>
      <button onclick="append('!')">n!</button>
      <button onclick="append('abs(')">abs</button>

      <button onclick="append('exp(')">exp</button>
      <button onclick="append('log2(')">log‚ÇÇ</button>
      <button onclick="append('sinh(')">sinh</button>
      <button onclick="append('cosh(')">cosh</button>
      <button onclick="append('tanh(')">tanh</button>
      <button onclick="append('floor(')">floor</button>
      <button onclick="append('ceil(')">ceil</button>

      <button class="clear" onclick="backspace()">‚úñ</button>
      <button class="equal" onclick="calculate()">=</button>
      <button class="enter" onclick="calculate()">Enter</button>
    </div>

    <!-- Memory + History -->
    <div style="margin-top:10px; display:flex; justify-content:space-between;">
      <div>
        <button onclick="memoryClear()">MC</button>
        <button onclick="memoryRecall()">MR</button>
        <button onclick="memoryAdd()">M+</button>
        <button onclick="memorySubtract()">M-</button>
      </div>
      <button onclick="toggleHistory()">üïë History</button>
    </div>

    <div id="historyPanel"></div>
  </div>

  <script>
    let display = document.getElementById('display');
    let history = [];
    let redoStack = [];
    let angleMode = 'RAD';
    let memory = 0;
    let calcHistory = [];

    function append(value) {
      history.push(display.value);
      display.value += value;
      redoStack = [];
    }
    function backspace() {
      history.push(display.value);
      display.value = display.value.slice(0, -1);
    }
    function clearAll() {
      history.push(display.value);
      display.value = '';
    }
    function undo() {
      if (history.length > 0) {
        redoStack.push(display.value);
        display.value = history.pop();
      }
    }
    function redo() {
      if (redoStack.length > 0) {
        history.push(display.value);
        display.value = redoStack.pop();
      }
    }
    function setMode(mode) {
      angleMode = mode;
      document.getElementById('radBtn').classList.remove('active');
      document.getElementById('degBtn').classList.remove('active');
      if (mode === 'RAD') {
        document.getElementById('radBtn').classList.add('active');
      } else {
        document.getElementById('degBtn').classList.add('active');
      }
    }
    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    // Memory Functions
    function memoryClear() { memory = 0; }
    function memoryRecall() { display.value += memory; }
    function memoryAdd() { memory += parseFloat(display.value) || 0; }
    function memorySubtract() { memory -= parseFloat(display.value) || 0; }

    // Extra Math
    function factorial(n) { if (n < 0) return NaN; if (n === 0 || n === 1) return 1; return n * factorial(n - 1); }
    function gcd(a, b) { if (!b) return a; return gcd(b, a % b); }
    function lcm(a, b) { return (!a || !b) ? 0 : Math.abs(a * b) / gcd(a, b); }
    function nPr(n, r) { return factorial(n) / factorial(n - r); }
    function nCr(n, r) { return factorial(n) / (factorial(r) * factorial(n - r)); }

    // Calculation
    function calculate() {
      try {
        let expr = display.value.replace(/pi/g, "Math.PI").replace(/e/g, "Math.E");
        expr = expr.replace(/sin\(/g, angleMode === 'DEG' ? 'degSin(' : 'Math.sin(');
        expr = expr.replace(/cos\(/g, angleMode === 'DEG' ? 'degCos(' : 'Math.cos(');
        expr = expr.replace(/tan\(/g, angleMode === 'DEG' ? 'degTan(' : 'Math.tan(');
        expr = expr.replace(/asin\(/g, angleMode === 'DEG' ? 'degAsin(' : 'Math.asin(');
        expr = expr.replace(/acos\(/g, angleMode === 'DEG' ? 'degAcos(' : 'Math.acos(');
        expr = expr.replace(/atan\(/g, angleMode === 'DEG' ? 'degAtan(' : 'Math.atan(');
        expr = expr.replace(/log\(/g, 'Math.log10(');
        expr = expr.replace(/ln\(/g, 'Math.log(');
        expr = expr.replace(/sqrt\(/g, 'Math.sqrt(');
        expr = expr.replace(/abs\(/g, 'Math.abs(');
        expr = expr.replace(/exp\(/g, 'Math.exp(');
        expr = expr.replace(/log2\(/g, 'Math.log2(');
        expr = expr.replace(/sinh\(/g, 'Math.sinh(');
        expr = expr.replace(/cosh\(/g, 'Math.cosh(');
        expr = expr.replace(/tanh\(/g, 'Math.tanh(');
        expr = expr.replace(/floor\(/g, 'Math.floor(');
        expr = expr.replace(/ceil\(/g, 'Math.ceil(');
        expr = expr.replace(/gcd\(/g, 'gcd(');
        expr = expr.replace(/lcm\(/g, 'lcm(');
        expr = expr.replace(/nPr\(/g, 'nPr(');
        expr = expr.replace(/nCr\(/g, 'nCr(');
        expr = expr.replace(/rand\(\)/g, 'Math.random()');
        expr = expr.replace(/(\d+)!/g, 'factorial($1)');

        function degSin(x) { return Math.sin(x * Math.PI / 180); }
        function degCos(x) { return Math.cos(x * Math.PI / 180); }
        function degTan(x) { return Math.tan(x * Math.PI / 180); }
        function degAsin(x) { return Math.asin(x) * 180 / Math.PI; }
        function degAcos(x) { return Math.acos(x) * 180 / Math.PI; }
        function degAtan(x) { return Math.atan(x) * 180 / Math.PI; }

        let result = eval(expr);
        calcHistory.push(display.value + " = " + result);
        updateHistory();
        display.value = result;
      } catch (e) {
        display.value = "Error";
      }
    }

    // History
    function updateHistory() {
      let historyPanel = document.getElementById("historyPanel");
      historyPanel.innerHTML = calcHistory.map(h => `<div onclick="reuse('${h.split('=')[1].trim()}')">${h}</div>`).join('');
    }
    function reuse(value) {
      display.value += value;
    }
    function toggleHistory() {
      let panel = document.getElementById("historyPanel");
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }

    // Tabs
    function showTab(tabId) {
      document.querySelectorAll('.buttons').forEach(div => div.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    // Keyboard Support
    document.addEventListener("keydown", function(e) {
      if (!isNaN(e.key) || "+-*/().".includes(e.key)) append(e.key);
      if (e.key === "Enter") calculate();
      if (e.key === "Backspace") backspace();
    });
  </script>
</body>
</html>
